19554927
article
36490908
https://zhuanlan.zhihu.com/p/36490908
x1aoh0n
NO.23 记一次企业中的钓鱼邮件演练

封面致巴黎干爹 祝今晚能勇夺震中杯冠军当我们谈到企业信息安全的时候，邮件安全的重要性总是被放到一个很高的位置。因为一个企业的信息安全防线可能最容易被突破的点可能不是web也不是服务器，而是一个信息安全意识薄弱的的企业员工，对于攻陷城池这种事情没什么比里应外合更容易的了。虽然信息安全这件事情一直是安全部门在做，但是说实话一个企业最重要的信息资产可不在我们这些安全人员身上，毕竟我们还是为了业务部门去服务的，属于后台支持部门。真正重要的信息资产，还是在业务部门的那些员工手里，但是作为普通员工来讲，信息安全意识水平也就层次不齐了。意识培训做了很多次，到处都是信息安全宣传海报和贴士，但是真正执行情况怎么样呢，还是需要做一次演练试试看。其实实现的思路也很简单，伪造一封高仿邮件，最简单的方法就是从你自己的邮箱里面找出一封类似于银行调查问卷，或者是登录异常提示的邮件，把邮件的html代码整个拔下来，保存。然后将邮件中的‘点击接受调查’‘查看是否本人登录’等等这种提示的链接，换成你想要换成的目标url。可以是你事先架好的一个被挂上木马的网站，也可以是其他什么东西。在这里我们只是简单的用apache架了个web服务器，然后放上了两个php脚本文件。 脚本的内容大概就是弹出一个提示‘您点击了钓鱼邮件，balabala’说教一下。同时脚本会获取客户端的ip地址，保存在服务器的数据库里。后期我们可以通过ip地址去找到是哪位员工点击了邮件中的恶意url，然后再去进一步对其进行信息安全教育和培训。钓鱼邮件已经伪造好了，下一步就是怎么把邮件发出去。你需要一台存在伪造邮件漏洞的邮箱服务器了，这台服务器会允许你可以不需要经过任何验证，去伪造一封发件人是任意邮箱的邮件，然后发给任意目标。你可以伪造为service@jd.com 或者service@taobao.com 之类的，你邮件是从哪里拔下来的你就直接用那个邮箱就可以了。不过如果你用的是投诉邮件之类的，可以把邮箱地址稍微改一下，a改成o之类的。避免有员工回复钓鱼邮件，直接发到原目标那里，造成不必要的麻烦。有了这台邮件服务器之后，我们只需要写一个群发邮件的程序调用SMTP协议登录这台服务器，把咱们改好的含有恶意内容的html文件作为邮件正文发出去即可。然后就可以等着数据库里出现一个一个IP，然后拿着IP地址去找人了。我做的时候遇到了个问题，大部分邮件中显示的图片，都是通过外链形式存在的。所以你保存的原邮件的图片处，例如商标之类的，应该也是一个图片外链。但是例如Outlook foxmail等好像都是不允许外链图片直接显示的，所以发过去邮件里的图片处可能就是一个✘，显得，不太好看。这时候我们可以把图片外链替换掉，直接传入一张本地图片。也就是把外链图片保存到本地，然后传入邮件当中。百度了一下方法 邮件正文嵌入本地图片的原理MIME(Multipurpose Internet Mail Extensions)协议支持在邮件头中指定各种类型的媒体文件，而邮件正文中则可以直接引用Header中定义的 Content-ID。以图片类型为例，MIME邮件头类似于：Content-Type: image/png; name="digglife.png"Content-Disposition: inline; filename="digglife.png"Content-Transfer-Encoding: base64Content-ID: <digglife>Content-Location: digglife.png邮件正文中则可以这样引用，注意src的内容。<img src="cid:digglife" alt="digglife">这样就可以啦。伪造目标选取的时候可以讲究一下，直接用购物网站钓鱼，大家见得也多了，免疫了。试一试公司楼下的星巴克啊，7-11什么的，或许有奇效噢。Engineering For The Win2018.5.6