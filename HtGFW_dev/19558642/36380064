19558642
article
36380064
https://zhuanlan.zhihu.com/p/36380064
史中
360唐青昊：虚拟世界的越狱者

大家好~我是 @史中，我的日常生活是开撩五湖四海的科技大牛，我会尝试各种姿势，把他们的无边脑洞和温情故事讲给你听。如果你特别想听到谁的故事，不妨加微信（微信号：shizhongst）告诉我，反正我也不一定撩得到。 不想走丢的话，你也可以关注我的自媒体公众号“浅黑科技”。                                 -------正文分割线-------360唐青昊：虚拟世界的越狱者文| @史中 这次选择，将永不能回头。你吞下蓝色药丸，将会在床上醒来，相信你曾经相信的一切；你吞下红色药丸，将留在这里，我来告诉你这个世界的真相。在尼奥做出抉择的十七年后，生活在数字矩阵中的每个人，如你如我，都再次面临这个艰难的抉择。吞下蓝色药丸，你会看到微信中跳动的联系人，支付宝中安静的余额；你脑海里的每一组用户名和密码，都让自己的身份铁证如山。吞下红色药丸，你会看到机房的排线，不息川流其中的代码；你的一切财产和名誉，都只是闪烁着妖冶光芒的红灯。唐青昊选择了那枚红色药丸。黑客X档案如果那天他没有在夕阳下的报刊亭多停留几秒，海贼王、火影忍者这类热血漫画将会一直占据这个高中生的叛逆时光。真是不巧，这本名为《黑客X档案》的杂志，在唐青昊最想改变世界的年龄，走进了他的视野。“如何制作远程控制软件，怎样截获QQ信息，如何攻击网站，怎样控制别人的电脑”，彼时中国人正处在奥运会的狂欢中，“有关部门”似乎也未有后来那般警惕。这个售价10元的畅销杂志得以“知无不言，言无不尽地”详细介绍了当时流行的各种黑客技术。这些如天神一般掌控世界的技术给了这个看上去平淡无奇的少年一个充满诱惑力的可能性。虽然当时我几乎看不懂这些具体的技术，但是却被这些攻击的路径和逻辑深深震撼。有一点我深信不疑，那就是——要想影响世界，就要成为一个黑客。唐青昊对我说。对于一代慵懒而盲目的学生而言，在大学之前就找到坚定的职业理想，显然是一种幸运。这种幸运让唐青昊有机会从长计议。他成为黑客的第一步，就是报考了吉林大学的软件工程专业。进入大学，眼看周围的人，无论大一大二还是大三大四，都整日忙于谈情说爱，过着“正常”的大学生活。不过这样的庸庸碌碌怎能是要“影响世界”的唐青昊的生活呢？于是，他的做法是：整日埋头钻研计算机技术，当然，在此之前，要先找到女朋友。。。【唐青昊】在大学，唐青昊成为了知名互联网安全论坛“看雪论坛”的常客。在这里，他认识了大名鼎鼎的前辈黑客汪列军和古河。“技术特别弱，欲望特别强。”是唐青昊对彼时自己的评价。正是凭借超强的欲望和自己制作的略带幼稚的远程控制软件，在大二的暑假，他有机会进入当时汪列军供职的老牌安全厂商绿盟实习；大三的时候，他得以进入古河供职的趋势科技实习。有趣的是，如今这三个人都被招至360麾下，成为不同领域的三面大旗。当然这是后话。正是在大二的时候，唐青昊发现了自己的黑客技能开始突飞猛进，远远甩掉还在继续谈情说爱的同学们。黑客大概分为两种：纯自学的和有人带的。纯自学的“野生黑客”很容易遇到天花板，但是跟着汪列军学习漏洞挖掘的时候，我才发现黑客技术的天究竟有多高。唐青昊说。和360的第一次过招大三的时候，已经学了两年基础知识的唐青昊已经不再满足于学校里的“系统编程”“编写驱动”这种纸上谈兵，迫不及待地想要影响世界了。这一年，他写出了人生中第一个“完美的”远程控制软件。之所以说完美，是因为这个软件不仅可以监控对方的显示器内容，可以控制对方的鼠标，还可以绕过卡巴斯基的查杀，也可以在360杀毒软件的鼻子底下顺利运行。唐青昊怎么能够错过这个炫技的好机会，他把软件的演示 Demo 放到了看雪安全论坛。出乎意料的是，他的帖子在论坛大火，而且竟然有人通过QQ联系到了他，出价购买了这个软件。唐青昊对360的胜利维持了大约一个月。直到另一个买家再次光临。这个买家告诉唐青昊，原来的软件已经被360查杀了，他想要买一个升级版，即使贵一点也无所谓。交谈中，他告诉唐青昊一个惊人的秘密。唐青昊回忆道：他告诉我，一个月前购买我控制软件的就是他的朋友，这个人把这个软件用在了“灰色地带”。仅仅一个月的时间，他赚到了一个天文数字。得知这些，唐青昊大吃一惊。他猛然意识到，这个世界远比想象中更复杂。而自己可以亲手制作一头猛兽，这头猛兽已经开始拥有影响世界的力量。他严辞拒绝了这个买家的请求，并且再也没有和这些人来往。在那个互联网的蛮荒时代，一念之差就可能犯错。现在想起来，我庆幸自己当时的选择。唐青昊说。这之后半年左右，国家正式出台相关法律，编写木马被认定为违法的行为。也正是在这一年，唐青昊的启蒙老师《黑客X档案》停刊，在最后一期中没有任何关于停刊原因的说明。《黑客帝国》+《盗梦空间》+《楚门的世界》“我上大学的时候，漏洞挖掘领域能称为高手的，全国大约只有100人。即使到现在，这个数量也不会超过200。在这么小的圈子里混，又认识大牛，不是很容易吗？”一毕业就进入360的唐青昊发现，原来这里有如此多的熟人。如此看来，“漏洞挖掘”成为他顺理成章的工作选择。作为一个天赋过人的选手，他没有选择传统的 Web 安全和方兴未艾的 Android 安全，而是选择了一个以几何数级膨胀的，正如潮水般把我们所有人吞没的数字矩阵：云。实际上，云计算不像这个名字听上去那么枯燥无味。通俗地讲，我们试图用虚拟计算的方法来替代真实存在的机箱。云上的虚拟机用纯软件的形态模拟出一个个主机，这些主机拥有虚拟的CPU、显卡、内存和硬盘，可以提供极其变态的计算和存储性能。我们熟悉的QQ、微信、支付宝这些服务其实都坐落在虚拟的云主机之上。目前， 包括中国在内的全世界互联网服务，都在以唐青昊都没有预想到的速度向云主机上迁移。在网线另一端，这是一场轰轰烈烈的革命。【诸多服务都坐落在云端】以阿里云为例，其上不仅运行着支付宝、淘宝这些重头业务，也租给无数企业或政府单位用以运转他们的业务。无论是阿里云、百度云、腾讯云，或者360云，都包含了无数相互独立的虚拟机。接下来到了熟悉的《黑客帝国》+《盗梦空间》+《楚门的世界》桥段：由于这些“虚拟机”是被“宿主机”创造出来的。所以根据设定，它们“以为”自己就是真实存在的主机，以为自己就是世界的全部，而不知道自己是宿主机所创造的一个“梦境”，更无法感知到身边其他虚拟机的存在。当然，运行在虚拟机上的支付宝是不会自我觉醒，进而发现自己其实生活在一片数字矩阵之中的。如果一切顺利，世界会相安无事地按照这个逻辑运行到天荒地老。但是，正如你已经知道的那样——唐青昊选择了那枚红色药丸。矩阵之上帝宿主机和虚拟机的关系，并不是母亲和孩子，而是上帝和众生。母亲虽然创造了孩子，但却不能控制他的行动；而上帝却可以看穿众生的每一个细胞。唐青昊首先要做的，就是以一个“破坏者”的身份来思考。化身一段代码，从云主机上的任何一个虚拟机进入，然后在其中吞下红色的药丸，完成一次旷世的觉醒，“逃逸”到宿主机之内。此时，唐青昊成为那个世界里不容置疑的神，在他眼里，身下所有的虚拟机，都不再是所谓的“支付宝”“微信”，而仅仅是一段段柔弱的代码。他可以动动手指，修改这个世界里的任何一个设定。【从虚拟机逃逸的黑客，可以成为“上帝”，修改同一宿主机下的任何设定】理论上来说，如果黑客入侵了合适的宿主机，他可以：为自己的支付宝余额加上10亿。删掉所有人的微信聊天记录。把白宫网站的首页换成莆田医院的广告。让一个城市所有的交通信号灯像舞池里一样闪烁。让一个国家的电力供应在一秒钟之内瘫痪。赛博世界的恐怖之处就在于它的极端简洁——所有的这些可怕的攻击，只需要两个条件：攻击对象本身处在云服务器之上；攻击者拥有一个致命的虚拟化漏洞。唐青昊的职责，就是带领着他的 Marvel Team 寻找这样的漏洞，并且在第一时间提交官方予以修补，防止坏人作恶。核武器：传送门寻找虚拟化的漏洞并不像找墙上的裂缝那么简单，实际上，这种攻击更像是冲出一个戒备森严的监牢。要逃出这个看上去真实无比的虚拟世界，就要发现其中的微小裂痕。正如盗梦空间中所言，只有当你做出一些意想不到的行为，这个裂痕才会显现。一个如空气般的虚拟机，要靠代码来模拟完成所有硬件的功能。所以要想发现虚拟机的漏洞，需要对于硬件最底层的运作原理有着清晰冷静的认识。正是由于门槛极高，全世界只有大约50人在做这类研究，至于其中顶尖的专家，不会超过10个人。这种致命的漏洞就真实地存在于虚拟化世界之中。唐青昊告诉史中，2015年爆出的毒液漏洞，就是一个非常致命的漏洞，在全球引起了极大的恐慌。但是，由于利用这个漏洞的条件非常苛刻，至今都没有人能够写出对于毒液漏洞的利用程序。而从另一面看，虚拟化软件本身也进化出越来越强大的安全防护策略。Marvel Team 用了两年时间，发现了30多个虚拟化漏洞。这些漏洞如同尼奥手中的机枪，可以打穿虚拟世界的边界。但是就漏洞本身的破坏性而言，它们都不及接下来这颗“原子弹”。就在之前，唐青昊和团队发现了主流虚拟化软件 Xen 和 Kvm 上存在的一个致命漏洞。这个漏洞的质量极高，仅仅依靠它就可以完整地实现虚拟机逃逸。唐青昊把这个漏洞命名为——暗黑传送门（Dark Portal）。然而，毒液漏洞的前车之鉴说明，仅仅发现了漏洞并不能证明它的实质危害性，还需要一个具有高度可操作性的攻击方法。为了利用漏洞实现最终的目标——虚拟机逃逸，唐青昊和同事们需要在矩阵中创造出“子弹时间”。无论一个CPU有多强大，它都不能同时运行两个指令。在足够小的时间片段内，它只能进行一次运算。为了骗过虚拟机，黑客需要在每一个时序内不断修改CPU寄存器内的数值。通过这种电子手术刀式的操作，可以劫持系统的运行流程，从而绕过系统对于简单溢出的攻击的缓解措施。形象地说来，这就像张生巧妙地躲在棋盘之后，跟着红娘的脚步和节奏行进，躲过众多的耳目接近最后的目标——崔莺莺。至此，黑客已经成功进入了虚拟世界最底层的“幻境”——Limbo。但是，此时也到了最为凶险的步骤。为了引爆这个核武器，黑客还需要一段代码作为引信。在 Limbo 里，一切都非常简单，这意味着任何外来的信息都会引起系统的警觉。为了成功制造这根引信，黑客需要“就地取材”，用内存中的地址符号拼凑出这段攻击代码。然而，这个世界的守护者并没有那么好欺骗。每个系统的地址编码都是随机的。为此，黑客首先需要破译地址符号。他们会守候在这里，读取大段的内存信息，从而根据特定的规则“猜出”地址符号。当这一步完成，便可以顺利地制造出引爆这个漏洞的引信。所有的这些，都在比你的极限想象还要短的一瞬间内完成。霎时间，秒针重新开始跳动，世界崩塌殆尽。尾声然而，这一切都只能在唐青昊的想象中发生。他要做的恰恰相反。在找到毁灭这个虚拟世界的方法之后，他会第一时间报告给虚拟化厂商，而厂商会马上通知阿里云百度云等云服务商进行修复，这样的修复一般在2天之内就可以完成。而在10天之后，虚拟化厂商会对外公布漏洞的详情。为了杜绝危险，他甚至不能把这个核武器在自己手上多留一秒。因为，一旦自己或者团队成员出于任何目的使用了这个核武器，都将会造成不可想象的后果。5月26日，唐青昊将赶赴阿姆斯特丹，在欧洲顶级安全会议HITB会议上，向世界分享他的成果。唐青昊的梦想是“影响世界”。有趣的是，如今他影响世界的方式，恰恰是在核武器被引爆之前，拆掉引信，让一切如原来一样平淡无奇。你也许听过这个有关扁鹊的故事：魏王问扁鹊：“我听说你们兄弟三人都擅长医术，那么三个人之中，谁的医术最高明？”扁鹊答说：“长兄最好，中兄次之，我最差。”魏王惊讶：“那为什么独有你闻名天下？”扁鹊答说：“我长兄治病，治病于病情发作之前。一般人无法了解他可以事先铲除病因，所以他的名气无法传扬，只有家人知道；我中兄治病，治病于病情初起之时。一般人以为他只能治治小疾，所以他的名气只及于本乡里。而我扁鹊治病，是治病于病情严重之时，一般人都看到我在经脉上穿针管来放血、在皮肤上敷药等大手术，所以以为我的医术高明，名气因此响遍全国。”居功至伟者，令世界如常。再自我介绍一下吧。我是 @史中，是一个倾心故事的科技记者。我的日常是和各路大神聊天。如果想和我做朋友，可以关注微博：史中方枪枪，或者加我微信：shizhongst。不想走丢的话，你也可以关注我的自媒体公众号“浅黑科技”。